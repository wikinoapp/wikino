# 検索機能実装タスク

## 概要

参加しているスペース内のページを検索できる機能を実装します。

## 要件

- URL: `GET /search`
- 検索対象: ユーザーが参加しているスペース内のページ
- 検索方法: ページタイトルの部分一致検索（ILIKE）
- UI: キーワード入力欄と検索結果のページリンク表示

## 実装タスク

### 1. ルーティングの追加

`config/routes.rb` に検索ページのルートを追加

### 2. コントローラーの作成

`app/controllers/search/show_controller.rb` を作成

- ユーザーが参加しているスペースを取得
- 検索キーワードがある場合は検索を実行
- 検索結果をビューに渡す

### 3. フォームオブジェクトの作成

`app/forms/pages/search_form.rb` を作成

- 検索キーワードの属性を定義
- ビジネスエラーのチェックを実装
  - 検索キーワードの最小文字数チェック（2文字以上）
  - 検索キーワードの最大文字数チェック（100文字以下）
  - 検索キーワードの形式チェック（不正な文字の検出）
  - 空文字列やnilの場合の処理

### 4. ビューの作成

`app/views/search/show_view.rb` を作成

- 検索フォームの定義
- 検索結果の表示ロジック

### 5. テンプレートの作成

`app/views/search/show.html.erb` を作成

- 検索キーワード入力欄
- 検索結果のページリンク一覧

### 6. テストの作成

- リクエストスペック: `spec/requests/search/show_spec.rb`
- フォームスペック: `spec/forms/pages/search_form_spec.rb`

## 実装の詳細

### データベースクエリ

- `PageRecord` を使用してページを検索
- `joins` でスペースとメンバーシップを結合
- `where` で現在のユーザーのメンバーシップをフィルタ
- `where("pages.title ILIKE ?", "%#{keyword}%")` でタイトル検索

### UI/UX

- 検索フォームは `GET` メソッドを使用
- 検索キーワードはURLパラメータで保持
- 検索結果は即座に表示（ページリロード）
- 検索結果がない場合は「検索結果がありません」と表示

### セキュリティ

- 必ずユーザーが参加しているスペースのページのみを検索
- SQLインジェクション対策（プレースホルダーの使用）
- XSS対策（ビューでの適切なエスケープ）
