<% title = t("meta.title.pages.show", space_name: Current.space!.name, page_title: @page.title) %>
<% set_meta_tags(title:) %>

<%= render ::Layouts::MainLayoutComponent.new do %>
  <div class="flex flex-col gap-4 p-4">
    <div class="flex items-center justify-between">
      <div class="flex flex-col gap-2">
        <h1 class="antialiased font-bold text-2xl">
          <%= @page.title %>
        </h1>

        <div class="flex gap-2 items-center">
          <%= link_to topic_path(@page.space.identifier, @page.topic.number), class: "flex gap-1 items-center link link-primary" do %>
            <%= render Icons::TopicIconComponent.new(topic: @page.topic, size: "16px", class_name: "fill-slate-500") %>

            <%= @page.topic.name %>
          <% end %>

          <% if @page.published? %>
            <div
              class="text-gray-400 text-sm"
              data-controller="absolute-time"
              data-absolute-time-utc-time-value="<%= @page.published_at.iso8601 %>"
            >
              <%= t("messages.time.ago_published", time: time_ago_in_words(@page.published_at)) %>
            </div>
          <% end %>

          <% if @page.modified? %>
            <div
              class="text-gray-400 text-sm"
              data-controller="absolute-time"
              data-absolute-time-utc-time-value="<%= @page.modified_at.iso8601 %>"
            >
              <%= t("messages.time.ago_modified", time: time_ago_in_words(@page.modified_at)) %>
            </div>
          <% end %>
        </div>
      </div>

      <% if policy(@page).update? %>
        <%= link_to edit_page_path(Current.space!.identifier, @page.number), {
          class: "btn btn-primary no-animation"
        } do %>
          <%= render Wikino::UI::Icon.new(name: "pencil-simple-line", size: "18px", class_name: "fill-primary-content") %>

          <%= t("verbs.edit") %>
        <% end %>
      <% end %>
    </div>

    <hr>

    <div class="wikino-markdown">
      <%= @page.body_html.html_safe %>
    </div>

    <div>
      <%= render Footers::PageFooterComponent.new(
        link_collection: @link_collection,
        backlink_collection: @backlink_collection
      ) %>
    </div>
  </div>
<% end %>
