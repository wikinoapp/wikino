<%= render Layouts::BasicComponent.new(current_page_name:, current_user:) do |layout| %>
  <%= layout.with_header do %>
    <%= render Headers::GlobalComponent.new(current_page_name:, current_user:) %>
  <% end %>

  <%= layout.with_main do %>
    <%= render BaseUI::ContainerComponent.new(
      as: BaseUI::ContainerComponent::As::Main,
      options: {class: "flex flex-col gap-6 px-4"}
    ) do %>
      <%= render Headers::MainTitleComponent.new(title: t("nouns.search")) do |main_title| %>
        <%= main_title.with_subtitle do %>
          <%= t("messages.search.subtitle") %>
        <% end %>
      <% end %>

      <div class="flex flex-col gap-6">
        <%= render BaseUI::CardComponent.new do |card| %>
          <%= card.with_body(class_name: "px-4") do %>
            <%= form_with(
              model: form,
              url: search_path,
              local: true,
              method: :get,
              class: "form flex flex-col gap-4"
            ) do |f| %>
              <%= render BaseUI::FormErrorsComponent.new(errors: f.object.errors) %>

              <div class="flex flex-col gap-2">
                <%= render BaseUI::LabelComponent.new(form_builder: f, method: :q) %>

                <%= f.text_field :q,
                  placeholder: t("messages.search.search_keyword_placeholder"),
                  class: "input w-full",
                  autofocus: true
                %>
              </div>

              <%= f.button class: "btn rounded-full w-fit", type: :submit do %>
                <%= render BaseUI::IconComponent.new(
                  name: "magnifying-glass-regular",
                  size: "18px",
                  class_name: "fill-primary-foreground"
                ) %>

                <%= t("verbs.search") %>
              <% end %>
            <% end %>
          <% end %>
        <% end %>

        <% if show_no_results_message? %>
          <%= render BaseUI::EmptyStateComponent.new(
            icon_name: "search",
            message: t("messages.search.no_results")
          ) %>
        <% elsif has_search_results? %>
          <div class="flex flex-col gap-2">
            <h2 class="text-sm font-bold">
              <%= t("messages.search.results_count", count: pages.size) %>
            </h2>

            <div class="flex flex-col gap-1">
              <% pages.each do |page| %>
                <div class="hover:bg-muted/50 rounded-lg border p-4 transition-colors">
                  <%= link_to page_path(page.space.identifier, page.number),
                    class: "block" do %>
                    <div class="flex flex-col gap-1">
                      <h3 class="font-medium">
                        <%= page.display_title %>
                      </h3>

                      <div class="text-muted-foreground text-sm">
                        <%= page.space.name %> / <%= page.topic.name %>
                      </div>

                      <div class="text-muted-foreground text-xs">
                        <%= t("messages.pages.modified_at", time: l(page.modified_at, format: :short)) %>
                      </div>
                    </div>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  <% end %>

  <%= layout.with_footer do %>
    <%= render Footers::GlobalComponent.new(signed_in: true) %>
  <% end %>
<% end %>
